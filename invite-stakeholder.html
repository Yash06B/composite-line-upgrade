<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invite Stakeholder - Composite Line Upgrade</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
</head>

<body>

    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <a href="index.html" class="brand-section" style="text-decoration: none; color: inherit;">
                <div class="logo-icon">
                    <span class="material-icons-outlined">layers</span>
                </div>
                <div class="brand-text">
                    <h1>Composite Line Upgrade</h1>
                    <div class="company-name">Customer Company Name</div>
                </div>
            </a>
            <!-- New Auth Nav (Replaces Meta) -->
            <!-- New Auth Nav (Replaces Meta) -->
            <div class="auth-nav">
                <a href="login.html" class="btn-login-bubble">Login</a>
            </div>
        </header>

        <!-- Top Grid: Context & Actions -->
        <div class="dashboard-grid">
            <!-- Left: Project Context -->
            <div class="card context-card">
                <div class="card-header"><span class="material-icons-outlined">feed</span> Project Context</div>
                <div class="context-details">
                    <h3>Application: Structural Bonding</h3>
                    <h3>Industry: Automotive</h3>
                </div>
                <div class="context-info">
                    This room contains verified information selected for this project.<br>All questions and answers are
                    shared with participants.
                </div>
            </div>

            <!-- Right: Action Menu -->
            <div class="card actions-card">
                <a href="participants.html" class="action-item">
                    <div class="action-left"><span class="material-icons-outlined icon-teal">group</span> Participants
                        (3)</div>
                    <span class="material-icons-outlined icon-gray">chevron_right</span>
                </a>
                <a href="qa-history.html" class="action-item">
                    <div class="action-left"><span class="material-icons-outlined icon-blue">history_edu</span> Q&A
                        History</div>
                    <span class="material-icons-outlined icon-gray">chevron_right</span>
                </a>
                <a href="invite-stakeholder.html" class="action-item" style="background: #f1f5f9;">
                    <div class="action-left"><span class="material-icons-outlined icon-teal">person_add</span> Invite
                        Stakeholder</div>
                    <span class="material-icons-outlined icon-gray">chevron_right</span>
                </a>
                <a href="resources.html" class="action-item">
                    <div class="action-left"><span class="material-icons-outlined icon-blue">description</span>
                        Resources</div>
                    <span class="material-icons-outlined icon-gray">chevron_right</span>
                </a>
                <a href="request-support.html" class="action-item">
                    <div class="action-left"><span class="material-icons-outlined icon-teal">support_agent</span>
                        Request Support</div>
                    <span class="material-icons-outlined icon-gray">chevron_right</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <main class="page-content">
            <div class="page-header">
                <h2>Invite Stakeholder</h2>
                <div class="breadcrumbs">
                    <a href="index.html">Dashboard</a> > Invite Stakeholder
                </div>
            </div>

            <div class="card" style="max-width: 600px; margin: 0 auto;">
                <div class="form-group">
                    <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Stakeholder Name</label>
                    <input type="text" id="stakeholder-name" placeholder="Ex: John Doe"
                        style="width:100%; padding:0.75rem; border:1px solid #cbd5e1; border-radius:8px;">
                </div>
                <div class="form-group" style="margin-top:1rem;">
                    <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Email Address</label>
                    <input type="email" id="stakeholder-email" placeholder="Ex: john.doe@company.com"
                        style="width:100%; padding:0.75rem; border:1px solid #cbd5e1; border-radius:8px;">
                </div>
                <div class="form-group" style="margin-top:1rem;">
                    <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Role / Department</label>
                    <select style="width:100%; padding:0.75rem; border:1px solid #cbd5e1; border-radius:8px;">
                        <option>Engineering</option>
                        <option>Process Safety</option>
                        <option>Procurement</option>
                        <option>Management</option>
                    </select>
                </div>

                <div style="margin-top:2rem; text-align:right;">
                    <button class="pill" style="background:var(--accent-teal); color:white; border:none;"
                        onclick="simulateInvite()">
                        Send Invite <span class="material-icons-outlined"
                            style="font-size:16px; margin-left:4px; vertical-align:middle;">send</span>
                    </button>
                </div>
            </div>
        </main>

        <footer class="app-footer">Powered by structured verified content. No hallucinations.</footer>
    </div>

    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function () {
            // Initialize EmailJS with Public Key (Placeholder)
            // USER: Replace "YOUR_PUBLIC_KEY" with your actual key from emailjs.com
            emailjs.init("521t5ss521h");
        })();
    </script>

    <script>
        function simulateInvite() {
            const name = document.getElementById('stakeholder-name').value;
            const email = document.getElementById('stakeholder-email').value;
            const sendBtn = document.querySelector('button[onclick="simulateInvite()"]');

            if (!name || !email) {
                if (window.showToast) {
                    window.showToast("Please enter both name and email.");
                } else {
                    alert("Please enter both name and email.");
                }
                return;
            }

            // Visual Feedback: Loading State
            const originalText = sendBtn.innerHTML;
            sendBtn.innerHTML = `Sending... <span class="material-icons-outlined" style="font-size:16px; margin-left:4px; vertical-align:middle; animation: spin 1s linear infinite;">refresh</span>`;
            sendBtn.disabled = true;

            // Add spinner keyframes if not exists
            if (!document.getElementById('spin-style')) {
                const style = document.createElement('style');
                style.id = 'spin-style';
                style.innerHTML = `@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }`;
                document.head.appendChild(style);
            }

            // Perform EmailJS Send
            const templateParams = {
                to_email: email,
                to_name: name,
                from_name: "Composite Line App",
                message: "You have been invited to join the Composite Line Upgrade project. Click here to access: https://app.keeploc.com"
            };

            emailjs.send('service_t5s521h', 'template_kfizdsd', templateParams)
                .then(function (response) {
                    console.log('SUCCESS!', response.status, response.text);
                    if (window.showToast) {
                        window.showToast(`Invitation sent to ${name}`);
                    } else {
                        alert(`Invitation sent to ${name}`);
                    }
                    resetForm();
                }, function (error) {
                    console.log('FAILED...', error);
                    if (window.showToast) {
                        window.showToast(`Failed to send: ${error.text || 'Unknown Error'}`);
                    } else {
                        alert(`Failed to send.`);
                    }
                })
                .finally(() => {
                    // Reset Button
                    sendBtn.innerHTML = originalText;
                    sendBtn.disabled = false;
                });
        }

        function resetForm() {
            document.getElementById('stakeholder-name').value = '';
            document.getElementById('stakeholder-email').value = '';
        }
    </script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <script src="config.js"></script>
    <script src="firebase_config.js"></script>
    <script src="auth.js"></script>
    <script src="script.js"></script>
</body>

</html>